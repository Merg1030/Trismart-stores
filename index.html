<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trismart - Authentication</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
:root{--p:#1e1e2f;--s:#2c2c44;--a:#ffcc00;--ah:#e6b800;--t:#fff;--ts:#b8b8cc;--cbg:#27293d;--br:8px;--tr:all .3s ease}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,var(--p)0%,#2d2d47 100%);color:var(--t);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:10px}
.auth-container{background:var(--cbg);border-radius:var(--br);box-shadow:0 8px 20px rgba(0,0,0,.5);width:100%;max-width:100%;overflow:hidden}
.auth-header{background:linear-gradient(135deg,var(--s)0%,#3a3a5e 100%);padding:1.2rem;text-align:center}
.logo{display:flex;align-items:center;justify-content:center;gap:8px;font-size:1.3rem;font-weight:700;color:var(--a);margin-bottom:.8rem}
.logo i{font-size:1.5rem}
.auth-tabs{display:flex;background:rgba(0,0,0,.2);border-bottom:1px solid rgba(255,255,255,.1)}
.auth-tab{flex:1;padding:.8rem;text-align:center;cursor:pointer;transition:var(--tr);font-weight:600;color:var(--ts);border-bottom:2px solid transparent;font-size:.9rem}
.auth-tab.active{color:var(--a);border-bottom:2px solid var(--a);background:rgba(255,255,255,.05)}
.auth-tab:hover:not(.active){background:rgba(255,255,255,.03);color:var(--t)}
.auth-content{padding:1.2rem}
.auth-section{display:none;animation:fadeIn .5s ease}
.auth-section.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.form-group{margin-bottom:1rem;position:relative}
.form-group label{display:block;margin-bottom:.4rem;font-weight:500;color:var(--ts);font-size:.9rem}
.input-with-icon{position:relative}
.input-with-icon i{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--ts);font-size:.9rem}
.input-with-icon input{padding-left:38px}
input{width:100%;padding:12px;border-radius:6px;border:1px solid rgba(255,255,255,.1);background:rgba(0,0,0,.2);color:var(--t);font-size:.95rem;transition:var(--tr)}
input:focus{outline:none;border-color:var(--a);box-shadow:0 0 0 2px rgba(255,204,0,.2)}
input::placeholder{color:var(--ts);font-size:.9rem}
.btn{display:inline-flex;align-items:center;justify-content:center;width:100%;padding:12px;border-radius:6px;border:none;font-weight:600;font-size:.95rem;cursor:pointer;transition:var(--tr);text-decoration:none;gap:6px}
.btn-primary{background:var(--a);color:var(--p)}
.btn-primary:hover{background:var(--ah);transform:translateY(-1px)}
.btn-secondary{background:rgba(255,255,255,.1);color:var(--t);border:1px solid rgba(255,255,255,.2)}
.btn-secondary:hover{background:rgba(255,255,255,.2);transform:translateY(-1px)}
.btn-logout{background:#f44336;color:#fff}
.btn-logout:hover{background:#d32f2f;transform:translateY(-1px)}
.form-footer{margin-top:1.2rem;text-align:center;color:var(--ts);font-size:.85rem}
.form-footer a{color:var(--a);text-decoration:none}
.form-footer a:hover{text-decoration:underline}
.alert{padding:10px;border-radius:6px;margin-bottom:1.2rem;display:none;font-size:.9rem}
.alert-success{background:rgba(76,175,80,.2);border:1px solid #4caf50;color:#a5d6a7}
.alert-error{background:rgba(244,67,54,.2);border:1px solid #f44336;color:#ffab91}
.payment-message{background:rgba(255,204,0,.2);border:1px solid var(--a);color:var(--a);padding:12px;border-radius:6px;margin-top:15px;text-align:center;display:none;font-size:.9rem}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;z-index:1000;opacity:0;visibility:hidden;transition:var(--tr)}
.modal-overlay.active{opacity:1;visibility:visible}
.modal{background:var(--cbg);border-radius:var(--br);width:95%;max-width:100%;padding:1.2rem;box-shadow:0 10px 25px rgba(0,0,0,.5);transform:translateY(-30px);transition:var(--tr);position:relative}
.modal-overlay.active .modal{transform:translateY(0)}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.2rem}
.modal-title{font-size:1.2rem;color:var(--a)}
.modal-close{background:none;border:none;color:var(--ts);font-size:1.3rem;cursor:pointer;transition:var(--tr)}
.modal-close:hover{color:var(--t)}
.payment-details{background:rgba(0,0,0,.2);border-radius:6px;padding:1.2rem;margin-bottom:1.2rem;font-size:.9rem}
.payment-option{margin-bottom:.8rem;padding-bottom:.8rem;border-bottom:1px solid rgba(255,255,255,.1)}
.payment-option:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}
.payment-option-title{font-weight:600;color:var(--a);margin-bottom:.4rem;font-size:.95rem}
.payment-option-details{color:var(--t);font-size:.9rem}
.transaction-form{margin-top:1.2rem}
.success-message{text-align:center;padding:1.2rem}
.success-icon{font-size:2.5rem;color:#4caf50;margin-bottom:.8rem}
.month-selection{margin:1.2rem 0}
.month-selection-title{font-weight:600;margin-bottom:.8rem;color:var(--a);font-size:.95rem}
.months-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
.month-checkbox{display:none}
.month-label{display:block;padding:8px;text-align:center;background:rgba(0,0,0,.2);border-radius:4px;cursor:pointer;transition:var(--tr);border:1px solid rgba(255,255,255,.1);font-size:.85rem}
.month-checkbox:checked+.month-label{background:var(--a);color:var(--p);font-weight:600;border-color:var(--a)}
.month-label.disabled{opacity:.5;cursor:not-allowed}
.amount-info{background:rgba(255,204,0,.1);border:1px solid rgba(255,204,0,.3);border-radius:6px;padding:8px;margin-top:.8rem;text-align:center;font-size:.85rem}
</style>
</head>
<body>
  <div class="auth-container">
    <div class="auth-header">
      <div class="logo">
        <i class="fas fa-chart-line"></i>
        <span>Trismart</span>
      </div>
      <p>Business Management Platform</p>
    </div>

    <div class="auth-tabs">
      <div class="auth-tab active" data-target="signup">Sign Up</div>
      <div class="auth-tab" data-target="login">Login</div>
      <div class="auth-tab" data-target="reset">Reset</div>
    </div>

    <div class="auth-content">
      <!-- Alert messages -->
      <div id="alertBox" class="alert"></div>
      
      <!-- Payment message for disabled accounts -->
      <div id="paymentMessage" class="payment-message">
        <i class="fas fa-exclamation-circle"></i>
        <p>Your account has been disabled. Please make a payment to regain access.</p>
        <button class="btn btn-primary" style="margin-top: 10px;" onclick="showPaymentModal()">
          <i class="fas fa-credit-card"></i> Make Payment
        </button>
      </div>

      <!-- Sign Up Section -->
      <div id="signup" class="auth-section active">
        <div class="form-group">
          <label for="name">Full Name</label>
          <div class="input-with-icon">
            <i class="fas fa-user"></i>
            <input type="text" id="name" placeholder="Your Name">
          </div>
        </div>

        <div class="form-group">
          <label for="businessName">Business Name</label>
          <div class="input-with-icon">
            <i class="fas fa-building"></i>
            <input type="text" id="businessName" placeholder="Business Name">
          </div>
        </div>

        <div class="form-group">
          <label for="businessPlace">Business Location</label>
          <div class="input-with-icon">
            <i class="fas fa-map-marker-alt"></i>
            <input type="text" id="businessPlace" placeholder="Business Location">
          </div>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number</label>
          <div class="input-with-icon">
            <i class="fas fa-phone"></i>
            <input type="text" id="phone" placeholder="Phone Number">
          </div>
        </div>

        <div class="form-group">
          <label for="businessNature">Nature of Business</label>
          <div class="input-with-icon">
            <i class="fas fa-briefcase"></i>
            <input type="text" id="businessNature" placeholder="Nature of Business">
          </div>
        </div>

        <div class="form-group">
          <label for="signupEmail">Email</label>
          <div class="input-with-icon">
            <i class="fas fa-envelope"></i>
            <input type="email" id="signupEmail" placeholder="Email">
          </div>
        </div>

        <div class="form-group">
          <label for="signupPassword">Password</label>
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input type="password" id="signupPassword" placeholder="Password">
          </div>
        </div>

        <button class="btn btn-primary" onclick="signUp()">
          <i class="fas fa-user-plus"></i> Create Account
        </button>

        <div class="form-footer">
          Already have an account? <a href="#" onclick="showSection('login')">Login here</a>
        </div>
      </div>

      <!-- Login Section -->
      <div id="login" class="auth-section">
        <div class="form-group">
          <label for="loginEmail">Email</label>
          <div class="input-with-icon">
            <i class="fas fa-envelope"></i>
            <input type="email" id="loginEmail" placeholder="Email">
          </div>
        </div>

        <div class="form-group">
          <label for="loginPassword">Password</label>
          <div class="input-with-icon">
            <i class="fas fa-lock"></i>
            <input type="password" id="loginPassword" placeholder="Password">
          </div>
        </div>

        <button class="btn btn-primary" onclick="login()">
          <i class="fas fa-sign-in-alt"></i> Login
        </button>

        <div class="form-footer">
          <a href="#" onclick="showSection('reset')">Forgot your password?</a><br>
          Don't have an account? <a href="#" onclick="showSection('signup')">Sign up here</a>
        </div>
      </div>

      <!-- Password Reset Section -->
      <div id="reset" class="auth-section">
        <div class="form-group">
          <label for="resetEmail">Email</label>
          <div class="input-with-icon">
            <i class="fas fa-envelope"></i>
            <input type="email" id="resetEmail" placeholder="Enter your email">
          </div>
        </div>

        <button class="btn btn-primary" onclick="resetPassword()">
          <i class="fas fa-paper-plane"></i> Send Reset Instructions
        </button>

        <div class="form-footer">
          Remember your password? <a href="#" onclick="showSection('login')">Login here</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="modal-overlay" id="paymentModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Make Payment</h2>
        <button class="modal-close" onclick="closeModal('paymentModal')">&times;</button>
      </div>
      <div class="modal-body">
        <p>Please send money to one of the following accounts:</p>
        
        <div class="payment-details">
          <div class="payment-option">
            <div class="payment-option-title">Airtel Money</div>
            <div class="payment-option-details">
              <p>Line: 0771287206</p>
              <p>Name: Christopher Chishela</p>
            </div>
          </div>
          
          <div class="payment-option">
            <div class="payment-option-title">FNB Bank</div>
            <div class="payment-option-details">
              <p>Account: 63042080133</p>
              <p>Name: Christopher Chishela</p>
            </div>
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="showTransactionIdModal()">
          <i class="fas fa-check-circle"></i> I've Made the Payment
        </button>
      </div>
    </div>
  </div>

  <!-- Transaction ID Modal -->
  <div class="modal-overlay" id="transactionIdModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Enter Payment Details</h2>
        <button class="modal-close" onclick="closeModal('transactionIdModal')">&times;</button>
      </div>
      <div class="modal-body">
        <p>Please enter your payment details below:</p>
        
        <div class="form-group">
          <label for="paymentAmount">Amount Paid (K)</label>
          <div class="input-with-icon">
            <i class="fas fa-dollar-sign"></i>
            <input type="number" id="paymentAmount" placeholder="Amount" oninput="updateMonthSelection()">
          </div>
        </div>
        
        <div class="form-group">
          <label for="transactionId">Transaction ID</label>
          <div class="input-with-icon">
            <i class="fas fa-receipt"></i>
            <input type="text" id="transactionId" placeholder="Transaction ID">
          </div>
        </div>
        
        <!-- Month Selection Section -->
        <div class="month-selection">
          <div class="month-selection-title">Select months you're paying for:</div>
          <div class="months-grid" id="monthsGrid">
            <!-- Months will be populated by JavaScript -->
          </div>
          <div class="amount-info" id="amountInfo">
            Enter amount to see available months
          </div>
        </div>
        
        <button class="btn btn-primary" onclick="submitPayment()">
          <i class="fas fa-paper-plane"></i> Submit Payment
        </button>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="modal-overlay" id="successModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Payment Submitted</h2>
        <button class="modal-close" onclick="closeModal('successModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="success-message">
          <div class="success-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <p>Your payment has been submitted successfully!</p>
          <p>Please wait for 5 minutes for accounts to approve.</p>
          <p>If it takes more than 5 minutes, call our Support team on:</p>
          <p style="font-weight: bold; margin-top: 10px; font-size: 1.2rem;">0771287206</p>
        </div>
      </div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    sendPasswordResetEmail, 
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDuAv_aGmY4VzergDS7g_K3zR-jFYHvGZo",
    authDomain: "trismart-online-app.firebaseapp.com",
    projectId: "trismart-online-app",
    storageBucket: "trismart-online-app.firebasestorage.app",
    messagingSenderId: "867677912389",
    appId: "1:867677912389:web:3c5ea505cb1e84a003d22c",
    measurementId: "G-KEWDREKNDB"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Current user data
  let currentUser = null;
  const monthlyFee = 40; // K40 monthly fee
  const monthNames = ["January", "February", "March", "April", "May", "June",
                     "July", "August", "September", "October", "November", "December"];

  // Initialize month selection
  function initMonthSelection() {
    const monthsGrid = document.getElementById('monthsGrid');
    monthsGrid.innerHTML = '';
    
    const currentMonth = new Date().getMonth();
    
    for (let i = 0; i < 12; i++) {
      const monthIndex = (currentMonth + i) % 12;
      const year = new Date().getFullYear() + Math.floor((currentMonth + i) / 12);
      
      const checkboxId = `month-${monthIndex}-${year}`;
      
      const monthElement = document.createElement('div');
      monthElement.innerHTML = `
        <input type="checkbox" id="${checkboxId}" class="month-checkbox" name="months" value="${monthIndex}-${year}">
        <label for="${checkboxId}" class="month-label disabled">${monthNames[monthIndex]} ${year}</label>
      `;
      
      monthsGrid.appendChild(monthElement);
    }
  }

  // Update month selection based on amount
  function updateMonthSelection() {
    const amount = parseFloat(document.getElementById('paymentAmount').value) || 0;
    const maxMonths = Math.floor(amount / monthlyFee);
    
    const checkboxes = document.querySelectorAll('.month-checkbox');
    const amountInfo = document.getElementById('amountInfo');
    
    if (amount <= 0) {
      amountInfo.textContent = "Enter amount to see available months";
      checkboxes.forEach(checkbox => {
        checkbox.disabled = true;
        checkbox.checked = false;
        checkbox.nextElementSibling.classList.add('disabled');
      });
      return;
    }
    
    // Enable months based on amount
    let enabledCount = 0;
    checkboxes.forEach((checkbox, index) => {
      if (index < maxMonths) {
        checkbox.disabled = false;
        checkbox.nextElementSibling.classList.remove('disabled');
        enabledCount++;
      } else {
        checkbox.disabled = true;
        checkbox.checked = false;
        checkbox.nextElementSibling.classList.add('disabled');
      }
    });
    
    // Update info text
    if (maxMonths === 0) {
      amountInfo.textContent = `Amount too low. Minimum payment is K${monthlyFee} for one month.`;
    } else if (maxMonths === 1) {
      amountInfo.textContent = `You can select 1 month with K${amount}`;
    } else {
      amountInfo.textContent = `You can select up to ${maxMonths} months with K${amount}`;
    }
    
    // Auto-select months if amount matches exactly
    if (amount % monthlyFee === 0 && amount > 0) {
      checkboxes.forEach((checkbox, index) => {
        if (index < maxMonths) {
          checkbox.checked = true;
        }
      });
    }
  }

  // Always start on login
  window.addEventListener('DOMContentLoaded', () => {
    showSection('login');
    initMonthSelection();
  });

  // Tab navigation
  document.querySelectorAll('.auth-tab').forEach(tab => {
    tab.addEventListener('click', () => showSection(tab.getAttribute('data-target')));
  });

  function showSection(sectionId) {
    document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelector(`.auth-tab[data-target="${sectionId}"]`).classList.add('active');

    document.querySelectorAll('.auth-section').forEach(sec => sec.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');

    hideAlert();
    hidePaymentMessage();
  }

  function showAlert(message, type) {
    const alertBox = document.getElementById('alertBox');
    alertBox.textContent = message;
    alertBox.className = `alert alert-${type}`;
    alertBox.style.display = 'block';
    setTimeout(hideAlert, 5000);
  }

  function hideAlert() {
    document.getElementById('alertBox').style.display = 'none';
  }
  
  function showPaymentMessage() {
    document.getElementById('paymentMessage').style.display = 'block';
  }
  
  function hidePaymentMessage() {
    document.getElementById('paymentMessage').style.display = 'none';
  }
  
  // Modal functions
  function showModal(modalId) {
    document.getElementById(modalId).classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  
  function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
    document.body.style.overflow = 'auto';
  }
  
  function showPaymentModal() {
    showModal('paymentModal');
  }
  
  function showTransactionIdModal() {
    closeModal('paymentModal');
    // Reset month selection when opening the modal
    document.getElementById('paymentAmount').value = '';
    document.getElementById('transactionId').value = '';
    initMonthSelection();
    showModal('transactionIdModal');
  }
  
  async function submitPayment() {
    const amount = parseFloat(document.getElementById('paymentAmount').value);
    const transactionId = document.getElementById('transactionId').value;
    
    if (!amount || !transactionId) {
      showAlert('Please enter both amount and transaction ID', 'error');
      return;
    }
    
    // Get selected months
    const selectedMonths = [];
    document.querySelectorAll('.month-checkbox:checked').forEach(checkbox => {
      selectedMonths.push(checkbox.value);
    });
    
    if (selectedMonths.length === 0) {
      showAlert('Please select at least one month', 'error');
      return;
    }
    
    // Validate amount matches selected months
    const expectedAmount = selectedMonths.length * monthlyFee;
    if (amount < expectedAmount) {
      showAlert(`Amount K${amount} is too low for ${selectedMonths.length} months. Required: K${expectedAmount}`, 'error');
      return;
    }
    
    try {
      // Format months for display
      const formattedMonths = selectedMonths.map(monthValue => {
        const [monthIndex, year] = monthValue.split('-').map(Number);
        return `${monthNames[monthIndex]} ${year}`;
      }).join(', ');
      
      // Save payment to Firestore
      await addDoc(collection(db, "payments"), {
        userId: currentUser.uid,
        userEmail: currentUser.email,
        userName: currentUser.name || 'Unknown',
        amount: amount,
        transactionId: transactionId,
        months: formattedMonths,
        monthValues: selectedMonths,
        status: 'pending',
        date: new Date(),
        type: 'account_reactivation'
      });
      
      // Show success message
      closeModal('transactionIdModal');
      showModal('successModal');
      
      // Clear the form fields for next time
      document.getElementById('paymentAmount').value = '';
      document.getElementById('transactionId').value = '';
      initMonthSelection();
      
    } catch (error) {
      showAlert('Error submitting payment: ' + error.message, 'error');
    }
  }

  // Sign Up
  async function signUp() {
    const name = document.getElementById("name").value;
    const businessName = document.getElementById("businessName").value;
    const businessPlace = document.getElementById("businessPlace").value;
    const phone = document.getElementById("phone").value;
    const businessNature = document.getElementById("businessNature").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;

    if (!name || !businessName || !businessPlace || !phone || !businessNature || !email || !password) {
      showAlert("Please fill in all fields!", "error");
      return;
    }

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCredential.user.uid;

      // Set admin role for chrischishe@gmail.com
      const role = email.toLowerCase() === "chrischishe@gmail.com" ? "admin" : "user";
      
      await setDoc(doc(db, "users", uid), {
        name, 
        businessName, 
        businessPlace, 
        phone, 
        businessNature, 
        email, 
        uid, 
        role: role,
        approved: role === "admin", // Auto-approve admin
        disabled: false // Default to not disabled
      });

      showAlert("Account created successfully! Redirecting...", "success");
      setTimeout(() => {
        if (role === "admin") {
          window.location.href = "admindash.html";
        } else {
          window.location.href = "dashboard.html";
        }
      }, 1500);

    } catch (error) {
      showAlert("Error: " + error.message, "error");
    }
  }

  // Login with admin check and disabled account check
  async function login() {
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPassword").value;

    if (!email || !password) {
      showAlert("Please enter both email and password", "error");
      return;
    }

    try {
      // Sign in with Firebase Auth
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const uid = userCredential.user.uid;

      // Fetch user data from Firestore
      const userDoc = await getDoc(doc(db, "users", uid));
      
      // Check if user exists and if account is disabled
      if (userDoc.exists()) {
        const userData = userDoc.data();
        currentUser = { ...userData, uid };
        
        // Check if account is disabled
        if (userData.disabled) {
          // Show payment message instead of signing out
          showPaymentMessage();
          showAlert("Your account has been disabled. Please make a payment to regain access.", "error");
          return;
        }
        
        // Check if account is approved (for non-admin users)
        if (!userData.approved && userData.role !== "admin") {
          await signOut(auth);
          showAlert("Your account is pending approval. Please contact support.", "error");
          return;
        }
        
        // Determine redirect based on role
        const redirectUrl = userData.role === "admin" ? "admindash.html" : "dashboard.html";
        
        showAlert("Login successful", 'success');
        setTimeout(() => {
          window.location.href = redirectUrl;
        }, 1500);
      } else {
        // If user document doesn't exist, create one with appropriate role
        const role = email.toLowerCase() === "chrischishe@gmail.com" ? "admin" : "user";
        const approved = role === "admin"; // Auto-approve admin
        
        await setDoc(doc(db, "users", uid), {
          email: email,
          uid: uid,
          role: role,
          approved: approved,
          disabled: false
        });
        
        currentUser = { email, uid, role, approved, disabled: false };
        
        const redirectUrl = role === "admin" ? "admindash.html" : "dashboard.html";
        
        showAlert("Login successful", 'success');
        setTimeout(() => {
          window.location.href = redirectUrl;
        }, 1500);
      }

    } catch (error) {
      showAlert("Error: " + error.message, "error");
    }
  }

  // Reset Password
  async function resetPassword() {
    const email = document.getElementById("resetEmail").value;
    if (!email) { 
      showAlert("Please enter your email.", "error"); 
      return; 
    }

    try {
      await sendPasswordResetEmail(auth, email);
      showAlert("Password reset email sent! Check your inbox.", "success");
    } catch (error) {
      showAlert("Error: " + error.message, "error");
    }
  }

  // Expose functions
  window.signUp = signUp;
  window.login = login;
  window.resetPassword = resetPassword;
  window.showSection = showSection;
  window.showPaymentModal = showPaymentModal;
  window.showTransactionIdModal = showTransactionIdModal;
  window.submitPayment = submitPayment;
  window.closeModal = closeModal;
  window.updateMonthSelection = updateMonthSelection;

   // -------------------------------
  // 1️⃣ Redirect after 15 minutes of inactivity
  // -------------------------------
  let inactivityTime = function () {
    let timer;
    const maxInactivity = 15 * 60 * 1000; // 15 minutes in milliseconds

    function resetTimer() {
      clearTimeout(timer);
      timer = setTimeout(() => {
       
        window.location.href = "index.html";
      }, maxInactivity);
    }

    // Listen to user events
    window.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeydown = resetTimer;
    document.onclick = resetTimer;
    document.onscroll = resetTimer;
  };

  inactivityTime();

  // -------------------------------
  // 2️⃣ Disable right-click
  // -------------------------------
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    
  });

  // -------------------------------
  // 3️⃣ Disable Ctrl+C, Ctrl+X, Ctrl+V
  // -------------------------------
  document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && (e.key === 'c' || e.key === 'x' || e.key === 'v')) {
      e.preventDefault();
      
    }
  });
</script>

</body>
</html>

